<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/themes/base/jquery-ui.min.css">
    <title>【ケーバイエヌ】お問合せフォーム</title>
	<style>
		/* Loading Block */
		#loading {
		  width: 100vw;
		  height: 100vh;
		  transition: all 1s;
		  background-color: #fff;
		  position: fixed;
		  top: 0;
		  left: 0;
		  z-index: 9999;
		}
		.spinner {
		  width: 100px;
		  height: 100px;
		  margin: 200px auto;
		  background-color: #7BCAC6;
		  border-radius: 100%;
		  animation: sk-scaleout 1.0s infinite ease-in-out;
		}
		/* Loading Animation */
		@keyframes sk-scaleout {
		  0% {
			transform: scale(0);
		  } 100% {
			transform: scale(1.0);
			opacity: 0;
		  }
		}

		/* Hide Loading Block */
		.loaded {
		  opacity: 0;
		  visibility: hidden;
		}
		

		.heading12 {
		  	margin-top: 20px;
			font-size: 1.2em;
			position: relative;
		}

		.heading12::before {
			content: attr(data-number);
			display: inline-block;
			margin-right: 20px;
			color: #7BCAC6;
			font-size: 30px;
			border-bottom: 1px solid #7BCAC6;
		}
		
		label {
		  	margin-top: 20px;
			font-size: 1.1em;
			display: block;
			color: #7BCAC6;/*文字色*/
			/*線の種類（点線）2px 線色*/
			border-bottom: dashed 2px #7BCAC6;
		}

		label.required:after {
		  margin-left: 1.0em;
		  padding: 0px 6px 0px 6px;
		  border-radius: 4px;
		  font-size: 0.6em;
		  color: white;
		  background-color: #C44;
		  content: "必須";
		}
		
		.label-point {
		    font-size: 0.7em;
		}
	</style>
</head>

<body>
	<div id="loading">
	  <div class="spinner"></div>
	</div>
    
    <form class="w-75 mx-auto"  name="form1">
	<h1 class="heading12" data-number="01"><ruby>お問合せ内容<rt>Inquiry content</rt></ruby></h1>
	<label class="required"><span class="label-point">Inquiry content</span><br>お問合せ内容</label>

        <div>
            <textarea class="form-control" id="exampleFormControlTextarea1"  id="naiyo" name="naiyo" rows="3" required></textarea>
        </div>
        <br>

	<h1 class="heading12" data-number="02"><ruby>お客様（保護者）の情報<rt>Customer (guardian) information</rt></ruby></h1>
	<label class="required"><span class="label-point">Name</span><br>名前</label>
        <div>
            <input class="form-control w-100 mt-1" id="name" name="name" placeholder="" required>
        </div>
	<label class="required"><span class="label-point">Furigana</span><br>フリガナ</label>
        <div>
            <input class="form-control w-100 mt-1" id="furigana" name="furigana" placeholder="" required>
        </div>
	<label class="required"><span class="label-point">PhoneNo</span><br>電話番号</label>
        <div>
            <input type="tel" class="form-control w-100 mt-1" id="phoneNo" name="phoneNo" placeholder="" required>
        </div>
	<label class="required"><span class="label-point">E-mail</span><br>メールアドレス</label>
        <div>
            <input type="email" class="form-control w-100 mt-1" id="email" name="email" placeholder="" required>
        </div>
	<label class="required"><span class="label-point">Address</span><br>住所</label>
        <div>
            <input class="form-control w-100 mt-1" id="address" name="address" placeholder="" required>
        </div>
	<label class="required"><span class="label-point">Nearest station</span><br>最寄り駅</label>
        <div>
            <input class="form-control w-100 mt-1" id="station" name="station" required>
		<br>
		<ruby>から徒歩<rt>How many minutes</rt></ruby><input class="form-control w-50 mt-1" id="time" name="time" required>
        </div>
	<h1 class="heading12" data-number="03"><ruby>お子様の情報<rt>Child information</rt></ruby></h1>
	<label class="required"><span class="label-point">First child information</span><br>1人目のお子様の情報</label>
        <div>
            <input type="date" class="form-control w-100 mt-1" id="child1birthday" name="child1birthday" >
        </div>
	<label><span class="label-point">Second child information</span><br>2人目のお子様の情報</label>
        <div>
            <input type="date" class="form-control w-100 mt-1" id="child2birthday" name="child2birthday" >
        </div>
	<label><span class="label-point">Third child information</span><br>3人目のお子様の情報</label>
        <div>
            <input type="date" class="form-control w-100 mt-1" id="child3birthday" name="child3birthday" >
        </div>
	<br>
	<div class="alert alert-danger" id="inputArrart" role="alert">
	  <p  id="arartText" ></p>
	</div>
        <input  type="submit" class="mt-4 btn btn-primary" value="送信">
    </form>
    <br>
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>

    <script>

        $(document).ready(function () {
            const liffId = "1660996109-5XePRDqM";
            initializeLiff(liffId);
        })
        
        liff.ready.then(() => {
          if (!liff.isLoggedIn()) {
            liff.login();
          }
          const idToken = liff.getDecodedIDToken();
          const userId = idToken.sub;
          getData(userId);
        })
        
        
        function initializeLiff(liffId) {
            liff.init({
                liffId: liffId
            }).then(() => {
                initializeApp();
            }).catch((err) => {
                console.log('LIFF Initialization failed ', err);
            });
        }

        function sendText(text) {
            liff.sendMessages([{
                'type': 'text',
                'text': text
            }]).then(function () {
                liff.closeWindow();
            }).catch(function (error) {
                window.alert('Failed to send message ' + error);
            });
        }

        const params = (new URL(document.location)).searchParams;
        const key = params.get('key');

        $(function () {
            $('form').submit(function () {
				// チェックしてアラートを出す
				let arartText = "";
				let child1birthdayArart = "";
				
				// アラートメッセージの初期化
				$("#inputArrart").html(arartText);
				
				// 1人目のお子様の誕生日
				if($('input[name="child1birthday"]').val()==""){
					child1birthdayArart  = "・1人目のお子様の誕生日は必ず入力してください<br>(Please enter the date of birth of your first child)"
				}
				arartText = child1birthdayArart;
				
			if(arartText!=""){
				$("#inputArrart").html(arartText);
				document.getElementById('inputArrart').classList.add('inputArrartShow');
				return false;
			}

                const name    = $('input[name="name"]').val();
                const furigana = $('input[name="furigana"]').val();
                const phoneNo  = $('input[name="phoneNo"]').val();
                const email  = $('input[name="email"]').val();
                const address = $('input[name="address"]').val();
                const station = $('input[name="station"]').val();
                const time = $('input[name="time"]').val();
                const child1birthday = $('input[name="child1birthday"]').val();
                const child2birthday = $('input[name="child2birthday"]').val();
                const child3birthday = $('input[name="child3birthday"]').val();
                const naiyo = document.form1.naiyo.value;
                const msg = `【区分】問合せ【氏名】${name}\n【フリガナ】${furigana}\n【電話番号】${phoneNo}\n【メールアドレス】${email}\n【住所】${address}\n【最寄り駅】${station}\n【駅からの時間】${time}\n【一人目のお子様】${child1birthday}\n【二人目のお子様】${child2birthday}\n【三人目のお子様】${child3birthday}\n【お問合せ内容】${naiyo}`;
                sendText(msg);
                return false;
            });
        });

    </script>
    <script>
        window.onload = function() {
            const spinner = document.getElementById('loading');

            setTimeout(function() {
                // Add .loaded to .loading
                spinner.classList.add('loaded');
            }, 3000);

        }
	</script>
    <script>
        function getData(userID) {
            const endpoint = "https://script.google.com/macros/s/AKfycbzczsoEpnEn_-Yy5BdgINcXmAkOgvd7HByeqyzwem13yGhoQIZE0_ieQQzvEV5kiD7vUw/exec";
              
            //APIを使って非同期データを取得する
            fetch((urlOf(endpoint, { userID: userID })))
            .then(response => response.json())
            /*成功した処理*/
            .then(data => {
                //JSONから配列に変換
                const object = data;
                //inputタグそれぞれに取得したデータを設定
                $('input').each(function (index, element) {
                    if (object[0][$(element).attr('name')]) {
                        $(element).val([object[0][$(element).attr('name')]]);
                    }
                });
            });
         }
        
        function urlOf(url, params) {
            return `${url}?${Object.entries(params).map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`).join('&')}`;
        }

    </script>
</body>
</html>
